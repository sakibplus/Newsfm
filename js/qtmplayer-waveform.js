function qtWaveformDebug(e){if(jQuery("#qtmusicplayer").data("debug")){var t=jQuery("#qtmPlayerDebugger");t.length>0&&t.append(e+"<br>")}}jQuery.storedPeaks=[];var qtDrawAudio=e=>{if(jQuery("#qtmplayerWaveform").length<=0)return;window.AudioContext=window.AudioContext||window.webkitAudioContext;const t=new AudioContext;if(jQuery("#qtmplayerWaveform canvas").remove(),jQuery("#qtmplayerWaveform").append('<canvas id="qtwaveformOriginal"></canvas><canvas id="qtwaveformClone"></canvas>'),jQuery.qtmplayerCanvas=jQuery("#qtmplayerWaveform #qtwaveformOriginal"),jQuery.qtmplayerCanvasClone=jQuery("#qtmplayerWaveform #qtwaveformClone"),jQuery.qtmplayerCanvasColor=jQuery("#qtmplayerWaveform").data("qtmplayer-color"),jQuery.qtmplayerCanvasCloneColor=jQuery("#qtmplayerWaveform").data("qtmplayer-color-clone"),jQuery("#qtmplayerTrackControl canvas").css({position:"absolute",top:0,left:0,width:"100%",height:"100%"}),void 0===jQuery.storedPeaks[e]){jQuery.ajax({type:"post",url:qtmplayer_ajax_var.url,data:{action:"qtmplayer-get-peaks",nonce:qtmplayer_ajax_var.peaksnonce,url:e},success:function(a){if(a&&""!=a&&null!=a){var o=jQuery.parseJSON(a);jQuery.storedPeaks[e]=o,draw(e,o,!1)}else fetch(e).then((e=>e.arrayBuffer())).then((e=>t.decodeAudioData(e))).then((t=>draw(e,normalizeData(filterData(t)),!0)))},fail:function(e){console.log(e)}})}else draw(e,jQuery.storedPeaks[e],!1)},filterData=e=>{const t=e.getChannelData(0);let a=120;1==jQuery("#qtmplayer").data("qtmplayer-detailedwaveform")&&(a=271);const o=Math.floor(t.length/a),r=[];for(let e=0;e<a;e++){let a=o*e,n=0;for(let e=0;e<o;e++)n+=Math.abs(t[a+e]);r.push(n/o)}return r},normalizeData=e=>{const t=Math.pow(Math.max(...e),-1);return e.map((e=>(e*t).toFixed(2)))};const drawDetail=(e,t,a)=>{const o=window.devicePixelRatio||1;jQuery.storedPeaks[e]=t;const r=jQuery.qtmplayerCanvas[0];r.width=r.offsetWidth*o,r.height=(r.offsetHeight+2)*o;const n=r.getContext("2d");n.scale(o,-o),n.translate(0,-r.offsetHeight-1-1);const l=(r.offsetWidth/t.length).toFixed(3);n.beginPath(),n.moveTo(0,0);for(let e=0;e<t.length;e++){let a=l*e,o=t[e]*r.offsetHeight-1+2;n.moveTo(a,0),n.lineTo(a,o),n.lineTo(Math.round(l-1+a),o),n.lineTo(Math.round(l-1+a),0),n.lineTo(Math.round(l+a),0)}n.moveTo(0,0),n.fillStyle=jQuery.qtmplayerCanvasColor,n.fill();const i=jQuery.qtmplayerCanvasClone[0];i.width=i.offsetWidth*o,i.height=(i.offsetHeight+2)*o;let s=i.getContext("2d");s.scale(o,-o),s.translate(0,-i.offsetHeight-1-1),s.beginPath(),s.moveTo(0,0);for(let e=0;e<t.length;e++){let a=l*e,o=t[e]*r.offsetHeight-1+2;s.moveTo(a,0),s.lineTo(a,o),s.lineTo(Math.round(l-1+a),o),s.lineTo(Math.round(l-1+a),0),s.lineTo(Math.round(l+a),0)}s.moveTo(0,0),s.fillStyle=jQuery.qtmplayerCanvasCloneColor,s.fill();let f=jQuery('[data-qtmplayer-file="'+e+'"]').closest(".qtmplayer-track-inpage");f.length>0&&f.each((function(e,a){var r=jQuery(a);r.find("canvas").remove(),r.css({position:"relative"}).append("<canvas>"),jQuery.qtmplayeCurrentCanvas=r.find("canvas"),jQuery.qtmplayeCurrentCanvas.css({position:"absolute",top:0,left:"0",width:"100%",height:"100%",background:"transparent","pointer-events":"none"});var n=jQuery.qtmplayeCurrentCanvas[0];n.width=n.offsetWidth*o,n.height=(n.offsetHeight+2)*o;var l=n.getContext("2d");l.scale(o,-o),l.translate(0,-n.offsetHeight-1-1);var i=(n.offsetWidth/t.length).toFixed(1);l.beginPath(),l.moveTo(0,0);for(let e=0;e<t.length;e++){let a=i*e,o=t[e]*n.offsetHeight-1+3;l.moveTo(a,0),l.lineTo(a,o),l.lineTo(Math.round(i-1+a),o),l.lineTo(Math.round(i-1+a),0),l.lineTo(i+a,0)}l.moveTo(0,0),l.fillStyle="rgba(210,210,210,0.5)",l.fill()})),1==a&&jQuery.ajax({type:"post",url:qtmplayer_ajax_var.url,data:{action:"qtmplayer-store-peaks",nonce:qtmplayer_ajax_var.peaksnonce,url:e,peaks:t},success:function(e){return!0},fail:function(e){return console.log(e),!1}})};var drawLineSegment=(e,t,a,o,r,n)=>{e.lineWidth=1,e.strokeStyle=n,e.beginPath(),a=r?a:-a,e.moveTo(t,0),e.lineTo(t,a),e.arc(t+o/2,a,o/2,Math.PI,0,r),e.lineTo(t+o,0),e.stroke()},draw=(e,t,a)=>{if(1==jQuery("#qtmplayer").data("qtmplayer-detailedwaveform"))return void drawDetail(e,t,a);const o=jQuery.qtmplayerCanvas[0],r=window.devicePixelRatio||1,n=14;o.width=o.offsetWidth*r,o.height=(o.offsetHeight+28)*r;const l=o.getContext("2d");l.scale(r,r),l.translate(0,o.offsetHeight/2+n);const i=o.offsetWidth/t.length;jQuery.storedPeaks[e]=t,1==a&&jQuery.ajax({type:"post",url:qtmplayer_ajax_var.url,data:{action:"qtmplayer-store-peaks",nonce:qtmplayer_ajax_var.peaksnonce,url:e,peaks:t},success:function(e){return!0},fail:function(e){return console.log(e),!1}});for(let e=0;e<t.length;e++){const a=i*e;let r=t[e]*o.offsetHeight-n;r<0?r=0:r>o.offsetHeight/2&&(r=r>o.offsetHeight/2),drawLineSegment(l,a,r,i,(e+1)%2,jQuery.qtmplayerCanvasColor)}const s=jQuery.qtmplayerCanvasClone[0];s.width=s.offsetWidth*r,s.height=(s.offsetHeight+28)*r;const f=s.getContext("2d");f.scale(r,r),f.translate(0,o.offsetHeight/2+n);for(let e=0;e<t.length;e++){const a=i*e;let r=t[e]*o.offsetHeight-n;r<0?r=0:r>o.offsetHeight/2&&(r=r>o.offsetHeight/2),drawLineSegment(f,a,r,i,(e+1)%2,jQuery.qtmplayerCanvasCloneColor)}};drawLineSegment=(e,t,a,o,r,n)=>{e.lineWidth=1,e.strokeStyle=n,e.beginPath(),a=r?a:-a,e.moveTo(t,0),e.lineTo(t,a),e.arc(t+o/2,a,o/2,Math.PI,0,r),e.lineTo(t+o,0),e.stroke()};